import streamlit as st
import pandas as pd

# --- 1. ê°€ìƒì˜(Dummy) ê°ì—¼ë³‘ ë°ì´í„° ìƒì„± ---
# ì‹¤ì œ ë°ì´í„°ê°€ ì•„ë‹ˆë©°, ê¸°ëŠ¥ì„ ì‹œì—°í•˜ê¸° ìœ„í•œ ì˜ˆì‹œ ë°ì´í„°ì…ë‹ˆë‹¤.
# 2024ë…„ ê¸°ì¤€ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì •í•©ë‹ˆë‹¤. (ì‹¤ì œ ë°ì´í„°ëŠ” ì§ˆë³‘ê´€ë¦¬ì²­ ë“±ì—ì„œ í™•ì¸ í•„ìš”)

data = {
    'ì§€ì—­': ['ì„œìš¸íŠ¹ë³„ì‹œ', 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'ì¸ì²œê´‘ì—­ì‹œ', 'ê´‘ì£¼ê´‘ì—­ì‹œ',
             'ëŒ€ì „ê´‘ì—­ì‹œ', 'ìš¸ì‚°ê´‘ì—­ì‹œ', 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', 'ê²½ê¸°ë„', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„',
             'ì¶©ì²­ë¶ë„', 'ì¶©ì²­ë‚¨ë„', 'ì „ë¼ë¶ë„', 'ì „ë¼ë‚¨ë„', 'ê²½ìƒë¶ë„',
             'ê²½ìƒë‚¨ë„', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„'],
    'ì¸êµ¬ìˆ˜_2024_ê°€ìƒ': [9400000, 3300000, 2400000, 3000000, 1400000,
                       1450000, 1100000, 390000, 13600000, 1500000,
                       1650000, 2150000, 1750000, 1800000, 2600000,
                       3300000, 680000],
    'ë…ê°_í™˜ììˆ˜_2024_ê°€ìƒ': [282000, 99000, 72000, 90000, 42000,
                             43500, 33000, 11700, 408000, 45000,
                             49500, 64500, 52500, 54000, 78000,
                             99000, 20400],
    'ê²°í•µ_í™˜ììˆ˜_2024_ê°€ìƒ': [9400, 3300, 2400, 3000, 1400,
                           1450, 1100, 390, 13600, 1500,
                           1650, 2150, 1750, 1800, 2600,
                           3300, 680],
    'ìˆ˜ì¡±êµ¬ë³‘_í™˜ììˆ˜_2024_ê°€ìƒ': [47000, 16500, 12000, 15000, 7000,
                                 7250, 5500, 1950, 68000, 7500,
                                 8250, 10750, 8750, 9000, 13000,
                                 16500, 3400],
    'ë…¸ë¡œë°”ì´ëŸ¬ìŠ¤_í™˜ììˆ˜_2024_ê°€ìƒ': [18800, 6600, 4800, 6000, 2800,
                                   2900, 2200, 780, 27200, 3000,
                                   3300, 4300, 3500, 3600, 5200,
                                   6600, 1360],
    'ì¼ë³¸ë‡Œì—¼_í™˜ììˆ˜_2024_ê°€ìƒ': [94, 165, 72, 90, 70, # ë‚¨ë¶€ ì§€ì—­ í™˜ììˆ˜ ìƒí–¥ ì¡°ì •
                              73, 55, 19, 136, 45,
                              49, 107, 87, 180, 130, # ë‚¨ë¶€ ì§€ì—­ í™˜ììˆ˜ ìƒí–¥ ì¡°ì •
                              165, 102], # ì œì£¼ ì§€ì—­ ìƒí–¥ ì¡°ì •
    'ë¹„ë¸Œë¦¬ì˜¤íŒ¨í˜ˆì¦_í™˜ììˆ˜_2024_ê°€ìƒ': [0, 66, 0, 90, 0, # í•´ì•ˆ ì§€ì—­ ìœ„ì£¼ ë°œìƒ
                                   0, 55, 0, 0, 0,
                                   0, 107, 175, 270, 130, # ì„œë‚¨í•´ì•ˆ ì§€ì—­ ìƒí–¥ ì¡°ì •
                                   165, 68] # ì œì£¼ ì§€ì—­ ìƒí–¥ ì¡°ì •
}

df = pd.DataFrame(data)

# ê° ì§ˆë³‘ì˜ í¼ì„¼íŠ¸ ê³„ì‚° í•¨ìˆ˜
def calculate_percentage(row, disease_col_prefix):
    disease_name = disease_col_prefix.split('_')[0]
    patient_col = f'{disease_name}_í™˜ììˆ˜_2024_ê°€ìƒ'

    total_patients = row[patient_col]
    population = row['ì¸êµ¬ìˆ˜_2024_ê°€ìƒ']
    return (total_patients / population) * 100 if population > 0 else 0.0

# ëª¨ë“  ê°ì—¼ë³‘ í¼ì„¼íŠ¸ ì¹¼ëŸ¼ ì¶”ê°€
disease_names = ['ë…ê°', 'ê²°í•µ', 'ìˆ˜ì¡±êµ¬ë³‘', 'ë…¸ë¡œë°”ì´ëŸ¬ìŠ¤', 'ì¼ë³¸ë‡Œì—¼', 'ë¹„ë¸Œë¦¬ì˜¤íŒ¨í˜ˆì¦']
for disease in disease_names:
    df[f'{disease}_í¼ì„¼íŠ¸'] = df.apply(lambda row: calculate_percentage(row, disease), axis=1)

# --- Streamlit ì•± êµ¬ì„± ---
st.set_page_config(layout="centered") # í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ì„¤ì •
st.title("ğŸ‡°ğŸ‡· ëŒ€í•œë¯¼êµ­ ì§€ì—­ë³„ ì£¼ìš” ê°ì—¼ë³‘ í˜„í™©")
st.markdown("---")
st.write("2024ë…„ ê°€ìƒ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, ëŒ€í•œë¯¼êµ­ ì‹œ/ë„ë³„ ì£¼ìš” ê°ì—¼ë³‘ ìœ ë³‘ë¥ (í¼ì„¼íŠ¸)ì„ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.")
st.write("ì•„ë˜ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.")

# ì§€ì—­ ëª©ë¡ ìƒì„±
regions = df['ì§€ì—­'].tolist()
# ìŠ¤íŠ¸ë¦¼ë¦¿ selectboxë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì—­ ì„ íƒ UI ìƒì„±
selected_region = st.selectbox(
    "**ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”:**",
    regions
)

# ì„ íƒëœ ì§€ì—­ì— ëŒ€í•œ ì •ë³´ í‘œì‹œ
if selected_region:
    selected_row = df[df['ì§€ì—­'] == selected_region].iloc[0]
    population = selected_row['ì¸êµ¬ìˆ˜_2024_ê°€ìƒ']

    st.subheader(f"ğŸ“ {selected_region} ({population:,}ëª…)ì˜ ì£¼ìš” ê°ì—¼ë³‘ í˜„í™©")

    diseases_info = {}
    for disease in disease_names:
        percentage_col = f'{disease}_í¼ì„¼íŠ¸'
        if percentage_col in selected_row:
            diseases_info[disease] = selected_row[percentage_col]

    # í¼ì„¼íŠ¸ê°€ ë†’ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 3ê°œë§Œ ì„ íƒ
    sorted_diseases = sorted(diseases_info.items(), key=lambda item: item[1], reverse=True)[:3]

    if sorted_diseases:
        for i, (disease, percentage) in enumerate(sorted_diseases):
            patient_count_col = f'{disease}_í™˜ììˆ˜_2024_ê°€ìƒ'
            patient_count = selected_row[patient_count_col] if patient_count_col in selected_row else 'N/A'
            st.write(f"**{i+1}. {disease}:** {percentage:.2f}% (í™˜ììˆ˜: {patient_count:,}ëª…)")
        st.markdown("---")
        st.info("ğŸ’¡ **ì°¸ê³ :** ì´ ë°ì´í„°ëŠ” ì‹¤ì œ í†µê³„ê°€ ì•„ë‹Œ, ì•± ê¸°ëŠ¥ ì‹œì—°ì„ ìœ„í•œ ê°€ìƒ ë°ì´í„°ì…ë‹ˆë‹¤.")
    else:
        st.warning("ì„ íƒí•˜ì‹  ì§€ì—­ì— ëŒ€í•œ ì£¼ìš” ê°ì—¼ë³‘ ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")
